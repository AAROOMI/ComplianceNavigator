<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>Metaworks Cybersecurity Compliance Platform</title>
    <meta name="description" content="NCA ECC V1 & V2 Compliance Management with AI-powered assistance" />
    <script
      type="module"
      src="https://agent.d-id.com/v1/index.js"
      data-name="did-agent"
      data-mode="fabio"
      data-client-key="YXV0aDB8NjdlZWI3NmYwOTYxZDU0Yjg2N2Y4ZWE3OkMwcExqeHpDYkl0VWt0N1dBQ056WQ=="
      data-agent-id="agt_56bnv71C"
      data-monitor="true"
      onload="console.log('D-ID Agent script loaded'); window.didAgentLoaded = true;"
      onerror="console.log('D-ID Agent failed to load - using fallback'); window.didAgentFailed = true;">
    </script>
    <script>
      // Enhanced D-ID agent initialization and debugging
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, checking for D-ID agent...');
        
        // Wait for D-ID agent to fully initialize
        setTimeout(() => {
          console.log('Checking D-ID agent status after page load...');
          console.log('Window properties with "did":', Object.keys(window).filter(k => k.toLowerCase().includes('did')));
          
          // Check for D-ID elements in DOM
          const didElements = document.querySelectorAll('*[class*="did"], *[id*="did"], *[data-testid*="did"]');
          console.log('Found D-ID elements:', didElements.length, didElements);
          
          // Check for iframes that might contain D-ID agent
          const iframes = document.querySelectorAll('iframe');
          console.log('Found iframes:', iframes.length, Array.from(iframes).map(iframe => iframe.src));
        }, 2000);
        
        // Global function to trigger D-ID agent or fallback chat
        window.openDIDAgent = function() {
          console.log('üöÄ Attempting to open D-ID agent...');
          
          // Check if D-ID failed to load, show fallback immediately
          if (window.didAgentFailed) {
            console.log('D-ID Agent failed to load, showing fallback chat...');
            showFallbackChat();
            return true;
          }
          
          // Method 1: Use the detected DID_AGENTS_API
          if (typeof window.DID_AGENTS_API !== 'undefined') {
            try {
              console.log('Available D-ID API:', window.DID_AGENTS_API);
              console.log('DID_AGENTS_API methods:', Object.keys(window.DID_AGENTS_API));
              
              // Try different methods on the API
              if (window.DID_AGENTS_API.show) {
                window.DID_AGENTS_API.show();
                console.log('‚úÖ D-ID Agent opened via DID_AGENTS_API.show()');
                return true;
              }
              if (window.DID_AGENTS_API.open) {
                window.DID_AGENTS_API.open();
                console.log('‚úÖ D-ID Agent opened via DID_AGENTS_API.open()');
                return true;
              }
              if (window.DID_AGENTS_API.start) {
                window.DID_AGENTS_API.start();
                console.log('‚úÖ D-ID Agent opened via DID_AGENTS_API.start()');
                return true;
              }
              if (window.DID_AGENTS_API.toggle) {
                window.DID_AGENTS_API.toggle();
                console.log('‚úÖ D-ID Agent toggled via DID_AGENTS_API.toggle()');
                return true;
              }
              // Try calling it as a function
              if (typeof window.DID_AGENTS_API === 'function') {
                window.DID_AGENTS_API();
                console.log('‚úÖ D-ID Agent called as function');
                return true;
              }
            } catch (error) {
              console.error('Error with DID_AGENTS_API:', error);
              showFallbackChat();
              return true;
            }
          }
          
          // Method 2: Look for D-ID floating button
          const fabButton = document.querySelector('[data-testid*="did"]') ||
                           document.querySelector('[class*="did-fab"]') ||
                           document.querySelector('[class*="agent-fab"]') ||
                           document.querySelector('button[class*="did"]') ||
                           document.querySelector('[id*="did"]');
          
          if (fabButton) {
            fabButton.click();
            console.log('‚úÖ Clicked D-ID FAB button');
            return true;
          }
          
          // If all else fails, show fallback chat after short delay
          setTimeout(() => {
            console.log('‚ö†Ô∏è D-ID agent not responding, showing fallback chat...');
            showFallbackChat();
          }, 2000);
          
          return false;
        };
        
        // Fallback chat interface for Sarah Johnson
        function showFallbackChat() {
          // Remove existing chat if present
          const existingChat = document.getElementById('sarah-chat-widget');
          if (existingChat) {
            existingChat.remove();
          }
          
          // Create chat widget
          const chatWidget = document.createElement('div');
          chatWidget.id = 'sarah-chat-widget';
          chatWidget.innerHTML = \`
            <div style="
              position: fixed;
              bottom: 20px;
              right: 20px;
              width: 350px;
              height: 500px;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              border-radius: 15px;
              box-shadow: 0 10px 30px rgba(0,0,0,0.3);
              z-index: 10000;
              display: flex;
              flex-direction: column;
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            ">
              <!-- Header -->
              <div style="
                background: rgba(255,255,255,0.1);
                padding: 15px;
                border-radius: 15px 15px 0 0;
                display: flex;
                align-items: center;
                justify-content: space-between;
                backdrop-filter: blur(10px);
              ">
                <div style="display: flex; align-items: center; gap: 10px;">
                  <div style="
                    width: 40px;
                    height: 40px;
                    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><circle cx="12" cy="8" r="3"/><path d="M12 14c-4 0-8 2-8 6v2h16v-2c0-4-4-6-8-6z"/></svg>') center/cover;
                    border-radius: 50%;
                    border: 2px solid rgba(255,255,255,0.3);
                  "></div>
                  <div>
                    <div style="color: white; font-weight: 600; font-size: 16px;">Sarah Johnson</div>
                    <div style="color: rgba(255,255,255,0.8); font-size: 12px;">CEO ‚Ä¢ Cybersecurity Expert</div>
                  </div>
                </div>
                <button onclick="document.getElementById('sarah-chat-widget').remove()" style="
                  background: none;
                  border: none;
                  color: white;
                  font-size: 20px;
                  cursor: pointer;
                  padding: 5px;
                  border-radius: 5px;
                  opacity: 0.7;
                " onmouseover="this.style.opacity='1'; this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.opacity='0.7'; this.style.background='none'">√ó</button>
              </div>
              
              <!-- Chat Messages -->
              <div id="sarah-chat-messages" style="
                flex: 1;
                padding: 20px;
                overflow-y: auto;
                background: rgba(255,255,255,0.05);
              ">
                <div style="
                  background: rgba(255,255,255,0.9);
                  padding: 12px 16px;
                  border-radius: 15px 15px 15px 5px;
                  margin-bottom: 15px;
                  color: #333;
                  font-size: 14px;
                  line-height: 1.4;
                ">
                  <div style="font-weight: 600; color: #667eea; margin-bottom: 5px;">Sarah Johnson</div>
                  üëã Hello! I'm Sarah Johnson, CEO of ComplianceNavigator. I'm here to help you with cybersecurity compliance, risk assessments, and NCA ECC implementation.
                </div>
                <div style="
                  background: rgba(255,255,255,0.9);
                  padding: 12px 16px;
                  border-radius: 15px 15px 15px 5px;
                  margin-bottom: 15px;
                  color: #333;
                  font-size: 14px;
                  line-height: 1.4;
                ">
                  <div style="font-weight: 600; color: #667eea; margin-bottom: 5px;">Sarah Johnson</div>
                  What can I help you with today? You can ask me about:
                  <ul style="margin: 8px 0 0 0; padding-left: 20px;">
                    <li>Risk assessment strategies</li>
                    <li>NCA ECC compliance requirements</li>
                    <li>Implementation best practices</li>
                    <li>Security policy development</li>
                  </ul>
                </div>
              </div>
              
              <!-- Input -->
              <div style="
                padding: 15px;
                background: rgba(255,255,255,0.1);
                border-radius: 0 0 15px 15px;
                backdrop-filter: blur(10px);
              ">
                <div style="display: flex; gap: 10px;">
                  <input 
                    id="sarah-chat-input" 
                    type="text" 
                    placeholder="Ask Sarah about cybersecurity..." 
                    style="
                      flex: 1;
                      padding: 10px 15px;
                      border: none;
                      border-radius: 25px;
                      background: rgba(255,255,255,0.9);
                      outline: none;
                      font-size: 14px;
                    "
                    onkeypress="if(event.key==='Enter') sendSarahMessage()"
                  >
                  <button 
                    onclick="sendSarahMessage()" 
                    style="
                      background: linear-gradient(45deg, #667eea, #764ba2);
                      border: none;
                      color: white;
                      width: 40px;
                      height: 40px;
                      border-radius: 50%;
                      cursor: pointer;
                      font-size: 16px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                    "
                    onmouseover="this.style.transform='scale(1.1)'" 
                    onmouseout="this.style.transform='scale(1)'"
                  >‚Üí</button>
                </div>
              </div>
            </div>
          \`;
          
          document.body.appendChild(chatWidget);
          
          // Focus input
          setTimeout(() => {
            const input = document.getElementById('sarah-chat-input');
            if (input) input.focus();
          }, 100);
          
          console.log('‚úÖ Sarah Johnson fallback chat opened');
        }
        
        // Handle chat messages
        window.sendSarahMessage = function() {
          const input = document.getElementById('sarah-chat-input');
          const messages = document.getElementById('sarah-chat-messages');
          
          if (!input || !messages || !input.value.trim()) return;
          
          const userMessage = input.value.trim();
          input.value = '';
          
          // Add user message
          const userDiv = document.createElement('div');
          userDiv.style.cssText = \`
            background: linear-gradient(45deg, #667eea, #764ba2);
            padding: 12px 16px;
            border-radius: 15px 15px 5px 15px;
            margin: 15px 0;
            margin-left: 50px;
            color: white;
            font-size: 14px;
            line-height: 1.4;
          \`;
          userDiv.innerHTML = \`<div style="font-weight: 600; margin-bottom: 5px; opacity: 0.8;">You</div>\${userMessage}\`;
          messages.appendChild(userDiv);
          
          // Simulate Sarah's response
          setTimeout(() => {
            const responses = [
              "That's a great question about cybersecurity compliance. Based on the NCA ECC framework, I recommend starting with a comprehensive risk assessment to identify your current security posture.",
              "For NCA ECC implementation, focus on the five core domains: Governance, Cybersecurity Defence, Cybersecurity Resilience, Third Party Cloud Computing, and Industrial Control Systems.",
              "Risk management is crucial for compliance. I suggest using our NFRM Risk Management tool to conduct thorough assessments and generate detailed reports.",
              "Security policies should align with your organizational structure. Our AI-powered policy generator can help you create customized policies based on NCA ECC requirements.",
              "Gap assessments are essential for identifying compliance gaps. Use our ECC Implementation Dashboard to track your progress across all 114 essential controls.",
              "Remember that cybersecurity compliance is an ongoing process. Regular assessments, continuous monitoring, and staff training are key components of a successful program."
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            const sarahDiv = document.createElement('div');
            sarahDiv.style.cssText = \`
              background: rgba(255,255,255,0.9);
              padding: 12px 16px;
              border-radius: 15px 15px 15px 5px;
              margin: 15px 0;
              color: #333;
              font-size: 14px;
              line-height: 1.4;
            \`;
            sarahDiv.innerHTML = \`<div style="font-weight: 600; color: #667eea; margin-bottom: 5px;">Sarah Johnson</div>\${randomResponse}\`;
            messages.appendChild(sarahDiv);
            
            // Scroll to bottom
            messages.scrollTop = messages.scrollHeight;
          }, 1000);
          
          // Scroll to bottom
          messages.scrollTop = messages.scrollHeight;
        };
      });
      });
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>