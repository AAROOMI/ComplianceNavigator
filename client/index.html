<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>Metaworks Cybersecurity Compliance Platform</title>
    <meta name="description" content="NCA ECC V1 & V2 Compliance Management with AI-powered assistance" />
    <script
      type="module"
      src="https://agent.d-id.com/v1/index.js"
      data-name="did-agent"
      data-mode="fabio"
      data-client-key="YXV0aDB8NjdlZWI3NmYwOTYxZDU0Yjg2N2Y4ZWE3OkMwcExqeHpDYkl0VWt0N1dBQ056WQ=="
      data-agent-id="agt_56bnv71C"
      data-monitor="true"
      onload="console.log('D-ID Agent script loaded')">
    </script>
    <script>
      // Enhanced D-ID agent initialization and debugging
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, checking for D-ID agent...');
        
        // Wait for D-ID agent to fully initialize
        setTimeout(() => {
          console.log('Checking D-ID agent status after page load...');
          console.log('Window properties with "did":', Object.keys(window).filter(k => k.toLowerCase().includes('did')));
          
          // Check for D-ID elements in DOM
          const didElements = document.querySelectorAll('*[class*="did"], *[id*="did"], *[data-testid*="did"]');
          console.log('Found D-ID elements:', didElements.length, didElements);
          
          // Check for iframes that might contain D-ID agent
          const iframes = document.querySelectorAll('iframe');
          console.log('Found iframes:', iframes.length, Array.from(iframes).map(iframe => iframe.src));
        }, 2000);
        
        // Global function to trigger D-ID agent using the detected API
        window.openDIDAgent = function() {
          console.log('üöÄ Attempting to open D-ID agent...');
          console.log('Available D-ID API:', window.DID_AGENTS_API);
          
          // Method 1: Use the detected DID_AGENTS_API
          if (typeof window.DID_AGENTS_API !== 'undefined') {
            try {
              // Try different methods on the API
              if (window.DID_AGENTS_API.show) {
                window.DID_AGENTS_API.show();
                console.log('‚úÖ D-ID Agent opened via DID_AGENTS_API.show()');
                return true;
              }
              if (window.DID_AGENTS_API.open) {
                window.DID_AGENTS_API.open();
                console.log('‚úÖ D-ID Agent opened via DID_AGENTS_API.open()');
                return true;
              }
              if (window.DID_AGENTS_API.start) {
                window.DID_AGENTS_API.start();
                console.log('‚úÖ D-ID Agent opened via DID_AGENTS_API.start()');
                return true;
              }
              if (window.DID_AGENTS_API.toggle) {
                window.DID_AGENTS_API.toggle();
                console.log('‚úÖ D-ID Agent toggled via DID_AGENTS_API.toggle()');
                return true;
              }
              // Try calling it as a function
              if (typeof window.DID_AGENTS_API === 'function') {
                window.DID_AGENTS_API();
                console.log('‚úÖ D-ID Agent called as function');
                return true;
              }
              console.log('DID_AGENTS_API methods:', Object.keys(window.DID_AGENTS_API));
            } catch (error) {
              console.error('Error with DID_AGENTS_API:', error);
            }
          }
          
          // Method 2: Look for D-ID floating button that should have been created
          setTimeout(() => {
            const fabButton = document.querySelector('[data-testid*="did"]') ||
                             document.querySelector('[class*="did-fab"]') ||
                             document.querySelector('[class*="agent-fab"]') ||
                             document.querySelector('button[class*="did"]') ||
                             document.querySelector('[id*="did"]');
            
            if (fabButton) {
              fabButton.click();
              console.log('‚úÖ Clicked D-ID FAB button');
              return true;
            }
          }, 500);
          
          // Method 3: Force trigger D-ID agent initialization
          const agentScript = document.querySelector('script[data-agent-id="agt_56bnv71C"]');
          if (agentScript) {
            // Simulate the agent script being executed again
            const event = new CustomEvent('did:agent:show', { 
              detail: { agentId: 'agt_56bnv71C', mode: 'fabio' } 
            });
            agentScript.dispatchEvent(event);
            window.dispatchEvent(event);
            console.log('‚úÖ Triggered D-ID agent via script events');
            return true;
          }
          
          console.log('‚ö†Ô∏è Could not activate D-ID agent automatically');
          return false;
        };
      });
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>